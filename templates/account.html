{% extends 'base.html' %}
{% from 'macros.html' import render_listing, init_map_script %}

{% block title %}Account{% endblock %}

{% block content %}
<br>
<br>
<br>
<div class="row" style="padding: 3%; background-color: gainsboro; border-radius:3px;">
    <div class="col col-md-3">
        <div class="row">
            <img src="https://source.unsplash.com/user/jampatcon/500x600" width="100%" height="100%" alt="User Profile">
        </div>
        <div class="row" style="padding-top:10px">
            {% if current_user.email == account.email %}
            <button type="button" class="btn btn-light btn-md active"
                onclick="window.location.href='{{ url_for('update_account', email = current_user.email) }}';">Edit
                account</button>
            {% else %}
            <button id="favorite_button">Favorite</button>
            {% endif %}
        </div>
    </div>

    <div class="col-md-1"></div>
    <div class="col-md-8">
        <h2>Name</h2>{{ account.first_name }} {{ account.last_name }}
        <br><br>
        <h2>Email</h2>{{ account.email }}
        <br><br>
        <h2>About Me</h2>{{ account.bio }}
    </div>


</div>
<div style="padding-top: 3%">
    <div class="row">
        <h3>{{ account.first_name }}'s listings</h3>
    </div>
    <div class="row">
        {%- for row in listings| batch(4) %}
        {%- for listing in row %}
        {{ render_listing(listing, current_user, account=account) }}
        {%- endfor %}
        {% else%}
        <div> No Listings Found </div>
        {%- endfor %}
    </div>
</div>
{{ init_map_script(listings) }}
<script>
    $('#favorite_button').click(function () {
        $.post("{{ url_for('mark_favorite') }}", { favorite_email: "{{ account.email }}" });
        globalThis.location.href = "{{ url_for('favorites', email = current_user.email) }}";
    });
</script>
{% endblock %}
